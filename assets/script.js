let infoBtn=document.getElementById("info-btn"),infoEl=document.getElementById("notice-info"),langBtn=document.getElementById("lang-btn"),langListEl=document.getElementById("lang-list"),playlistEl=document.getElementById("playlist-window"),playlistBtn=document.getElementById("playlist-btn"),menuBtn=document.getElementById("menu-btn"),menuEl=document.getElementById("menu-window"),menuIcon=document.getElementById("menu-icon"),audioTitleEl=document.getElementById("audio-title"),audioEl1=document.getElementById("audio-player-1"),audioEl2=document.getElementById("audio-player-2"),songSwitch=document.getElementById("song-switch"),audioControlSwitch=document.getElementById("audio-control-switch"),audioPlaylist=document.getElementById("audio-playlist"),wordsFilterBtn=document.getElementById("words-filter-btn"),soundFilterBtn=document.getElementById("sound-filter-btn"),songFilterBtn=document.getElementById("song-filter-btn"),playBtn=document.getElementById("play-btn"),replayBtn=document.getElementById("replay-btn"),prevBtn=document.getElementById("prev-btn"),nextBtn=document.getElementById("next-btn"),baseUrl=document.getElementById("baseUrl").getAttribute("href"),lastFocusedEl=null,isWaitingAudio=!1,timeoutId=null,audiosData,songsData,randomAud,randomSong,currentAud,prevAud,nextAud,prevAudPlaylist,filterUsed="",abortController,toggleMainUi=()=>{var el,mainUiEl=document.getElementsByClassName("main-ui"),isPlaylistExpanded="true"===playlistBtn.ariaExpanded,isMenuExpanded="true"===menuBtn.ariaExpanded;for(el of mainUiEl)el.toggleAttribute("inert",isPlaylistExpanded||isMenuExpanded),el.setAttribute("aria-hidden",isPlaylistExpanded||isMenuExpanded),el.classList.toggle("opacity-0",isPlaylistExpanded||isMenuExpanded)},togglePlaylistWindow=()=>{var ariaExpanded="true"===playlistBtn.ariaExpanded;playlistEl.classList.toggle("ltr:md:-translate-x-full",ariaExpanded),playlistEl.classList.toggle("rtl:md:translate-x-full",ariaExpanded),playlistEl.classList.toggle("translate-y-full",ariaExpanded),playlistEl.toggleAttribute("inert",ariaExpanded),playlistEl.setAttribute("aria-hidden",ariaExpanded),playlistBtn.setAttribute("aria-expanded",!ariaExpanded),toggleMainUi(),ariaExpanded?(lastFocusedEl.focus(),lastFocusedEl=null,audioPlaylist.getElementsByClassName("played-audio")[0]?.classList.remove("played-audio")):(lastFocusedEl=document.activeElement,document.getElementById("focused-audio").focus())},toggleMenuWindow=()=>{var ariaExpanded="true"===menuBtn.ariaExpanded;menuEl.classList.toggle("ltr:translate-x-full",ariaExpanded),menuEl.classList.toggle("rtl:-translate-x-full",ariaExpanded),menuEl.toggleAttribute("inert",ariaExpanded),menuEl.setAttribute("aria-hidden",ariaExpanded),menuIcon.innerText=ariaExpanded?"🌂":"☂️",menuIcon.classList.toggle("ltr:md:-translate-x-[8px]",!ariaExpanded),menuIcon.classList.toggle("rtl:md:translate-x-[8px]",!ariaExpanded),menuIcon.classList.toggle("md:translate-y-[8px]",!ariaExpanded),menuBtn.setAttribute("aria-expanded",!ariaExpanded),playlistEl.classList.toggle("md:w-3/4",ariaExpanded),playlistEl.classList.toggle("md:w-1/2",!ariaExpanded),ariaExpanded&&menuBtn.focus(),toggleMainUi()},openPlaylistWindow=e=>{e.preventDefault(),togglePlaylistWindow()},filterPlaylist=(el,list)=>{var isChecked="true"===el.ariaChecked,el=(audioPlaylist.classList.toggle("words-list",isChecked||"words"===list),audioPlaylist.classList.toggle("sound-list",isChecked||"sound"===list),audioPlaylist.classList.toggle("song-list",isChecked||"song"===list),wordsFilterBtn.setAttribute("aria-checked",wordsFilterBtn===el&&!isChecked),soundFilterBtn.setAttribute("aria-checked",soundFilterBtn===el&&!isChecked),songFilterBtn.setAttribute("aria-checked",songFilterBtn===el&&!isChecked),filterUsed=isChecked?"":list,document.getElementById("focused-audio"));el.dataset.category!==list&&(isChecked=audioPlaylist.querySelector(`[data-category="${list}"]`),el.removeAttribute("id"),el.setAttribute("tabindex","-1"),isChecked.setAttribute("id","focused-audio"),isChecked.setAttribute("tabindex","0"))},fetchAudioData=async()=>{try{var response=await fetch(baseUrl+"assets/audio.json");if(429==response.status)throw new Error("Rate limited. 429 HTTP status code");if(response.ok)return await response.json();throw new Error("Fetch audio data failed")}catch(error){throw error}},fetchAudio=async(audioName,signal=null)=>{try{var blob,response=await fetch(baseUrl+`assets/aud/${audioName}.mp3`,{signal:signal});if(429==response.status)throw new Error("Rate limited. 429 HTTP status code");if(response.ok)return blob=await response.blob(),URL.createObjectURL(blob);throw new Error(`Fetch ${audioName}.mp3 audio file failed`)}catch(error){throw error}},getRandomAudio=audiosData=>{let randomAudio;for(;!(randomAudio=audiosData[Math.floor(Math.random()*audiosData.length)]).isSeiso||randomAudio.name===currentAud?.name||randomAudio.name===prevAud?.name||randomAudio.name===nextAud?.name;);return randomAudio.objectUrl||(randomAudio.objectUrl=fetchAudio(randomAudio.name)),randomAudio},getAudioData=async()=>{try{let objectUrl;return songSwitch.checked&&.6<Math.random()&&"songPending"!==(objectUrl=await Promise.race([randomSong.objectUrl,"songPending"]))?(randomSong.objectUrl=objectUrl,randomSong):("audPending"===(objectUrl=await Promise.race([randomAud.objectUrl,"audPending"]))&&(audioTitleEl.innerText="Loading...",audioTitleEl.classList.add("cursor-wait"),isWaitingAudio=!0,objectUrl=await randomAud.objectUrl),randomAud.objectUrl=objectUrl,randomAud)}catch(error){throw error}},clearAudioData=audioData=>{if(audioData&&(audioData.name!==randomAud.name&&audioData.name!==randomSong?.name&&audioData.name!==nextAud?.name&&audioData.name!==prevAudPlaylist?.name&&(URL.revokeObjectURL(audioData.objectUrl),audioData.objectUrl=null),audioData.next)&&audioData.next!==currentAud?.name&&audioData.next!==randomAud.name&&audioData.next!==randomSong?.name&&audioData.next!==prevAudPlaylist?.name){let nextAudioData=audiosData.filter(ad=>ad.name===audioData.next);(nextAudioData=0==nextAudioData.length?songsData.filter(ad=>ad.name===audioData.next):nextAudioData).objectUrl?.then(ou=>URL.revokeObjectURL(ou)),nextAudioData.objectUrl=null}},setPrevAud=()=>{!currentAud||!songSwitch.checked&&"song"===currentAud.category||(prevAud=currentAud,prevBtn.title=currentAud.title,prevBtn.classList.remove("invisible"))},setNextAud=audioNext=>{if(audioNext){let nextAudioData=audiosData.filter(ad=>ad.name===audioNext);if(0==nextAudioData.length&&songSwitch.checked)nextAudioData=songsData.filter(ad=>ad.name===audioNext);else if(0==nextAudioData.length&&!songSwitch.checked)return;(nextAud=nextAudioData[0]).objectUrl||(nextAud.objectUrl=fetchAudio(audioNext)),nextBtn.classList.remove("invisible"),nextBtn.setAttribute("title",nextAud.title)}else nextAud=void 0,nextBtn.classList.add("invisible"),nextBtn.removeAttribute("title")},playRandomAudio=audioData=>{currentAud=audioData,audioTitleEl.innerText=audioData.title,audioTitleEl.classList.remove("cursor-wait"),audioEl1.src=audioData.objectUrl,audioEl1.play().then(()=>{},()=>console.log(audioData.name,audioEl1.src)),isWaitingAudio=!1},playAudio=async el=>{var audioName=el.getAttribute("data-name");if(audioName===prevAudPlaylist?.name)audioEl2.play();else{abortController&&abortController.abort(),abortController=new AbortController;try{var fetchOu=fetchAudio(audioName,abortController.signal),objectUrl=(el.classList.add("cursor-wait"),el.classList.add("animate-loading"),el.classList.contains("played-audio")||(audioPlaylist.getElementsByClassName("played-audio")[0]?.classList.remove("played-audio"),el.classList.add("played-audio")),await fetchOu);audioEl2.src=objectUrl,audioEl2.play(),prevAudPlaylist?.objectUrl&&URL.revokeObjectURL(prevAudPlaylist?.objectUrl),prevAudPlaylist={name:audioName,objectUrl:objectUrl}}catch(error){"AbortError"===error.name?console.log(`Fetching ${audioName} file aborted`):(console.error(error),alert("Error"))}finally{el.classList.remove("cursor-wait"),el.classList.remove("animate-loading"),abortController=null}}};(async()=>{try{var data=await fetchAudioData();audiosData=data.filter(data=>"song"!==data.category),songsData=data.filter(data=>"song"===data.category),randomAud=getRandomAudio(audiosData),songSwitch.checked&&(randomSong=getRandomAudio(songsData))}catch(error){console.error("Initialization failed -",error),alert("Error")}})(),infoBtn.onclick=()=>{var ariaExpanded="true"===infoBtn.ariaExpanded;infoEl.classList.toggle("hidden",ariaExpanded),infoBtn.setAttribute("aria-expanded",!ariaExpanded)},langBtn.onclick=()=>{var ariaExpanded="true"===langBtn.ariaExpanded;langListEl.classList.toggle("hidden",ariaExpanded),langBtn.setAttribute("aria-expanded",!ariaExpanded)},playlistBtn.onclick=togglePlaylistWindow,menuBtn.onclick=toggleMenuWindow,document.getElementById("close-playlist-btn").onclick=togglePlaylistWindow,menuEl.querySelectorAll(".switch").forEach(el=>{el.onkeydown=e=>{var changeEvent;"Enter"===e.key&&(e=e.target.children[1],changeEvent=new Event("change"),e.checked=!e.checked,e.dispatchEvent(changeEvent))}}),songSwitch.onchange=()=>{let isChecked=songSwitch.checked;isChecked&&void 0!==songsData&&void 0===randomSong&&(randomSong=getRandomAudio(songsData)),replayBtn.classList.toggle("invisible",!currentAud||"song"===currentAud?.category&&!isChecked),prevBtn.classList.toggle("invisible",!prevAud||"song"===prevAud?.category&&!isChecked),nextBtn.classList.toggle("invisible",!nextAud||"song"===nextAud?.category&&!isChecked),audioPlaylist.querySelectorAll('[data-category="song"]').forEach(el=>{el.classList.toggle("opacity-50",!isChecked),el.classList.toggle("hover:bg-white",isChecked),el.classList.toggle("hover:-translate-x-[2px]",isChecked),el.classList.toggle("hover:-translate-y-[2px]",isChecked),el.classList.toggle("cursor-pointer",isChecked),el.setAttribute("aria-disabled",!isChecked)})},audioControlSwitch.onchange=()=>{audioEl1.toggleAttribute("controls",audioControlSwitch.checked),audioEl2.toggleAttribute("controls",audioControlSwitch.checked)},audioPlaylist.onkeydown=e=>{if("ArrowDown"===e.key||"ArrowUp"===e.key){var listFocused=e.target;let nextListFocused="ArrowDown"===e.key?listFocused.nextElementSibling:listFocused.previousElementSibling;for(;""!==filterUsed&&nextListFocused&&nextListFocused.dataset.category!==filterUsed;)nextListFocused="ArrowDown"===e.key?nextListFocused.nextElementSibling:nextListFocused.previousElementSibling;if(null===nextListFocused)return;listFocused.removeAttribute("id"),listFocused.setAttribute("tabindex","-1"),nextListFocused.setAttribute("id","focused-audio"),nextListFocused.setAttribute("tabindex","0"),nextListFocused.focus()}"Enter"===e.key&&playAudio(e.target)},audioPlaylist.onclick=e=>{let listSelected;var e=e.target;if(e.hasAttribute("data-name"))listSelected=e;else{if(!e.parentElement.hasAttribute("data-name"))return;listSelected=e.parentElement}"true"!==listSelected.ariaDisabled&&(listSelected.hasAttribute("id")||((e=document.getElementById("focused-audio")).removeAttribute("id"),e.setAttribute("tabindex","-1"),listSelected.setAttribute("id","focused-audio"),listSelected.setAttribute("tabindex","0")),listSelected.classList.contains("played-audio")||(document.getElementsByClassName("played-audio")[0]?.classList.remove("played-audio"),listSelected.classList.add("played-audio")),playAudio(listSelected))},wordsFilterBtn.onclick=()=>{filterPlaylist(wordsFilterBtn,"words")},soundFilterBtn.onclick=()=>{filterPlaylist(soundFilterBtn,"sound")},songFilterBtn.onclick=()=>{filterPlaylist(songFilterBtn,"song")},playBtn.onmousedown=e=>{timeoutId=setTimeout(openPlaylistWindow,1e3,e)},playBtn.ontouchstart=e=>{timeoutId=setTimeout(openPlaylistWindow,1e3,e)},playBtn.onmouseup=()=>{clearTimeout(timeoutId)},playBtn.ontouchend=()=>{clearTimeout(timeoutId)},playBtn.onclick=async()=>{if(!isWaitingAudio)try{var audioData=await getAudioData();clearAudioData(prevAud),setPrevAud(),playRandomAudio(audioData),setNextAud(audioData.next),"song"===audioData.category?randomSong=getRandomAudio(songsData):randomAud=getRandomAudio(audiosData)}catch(error){"AbortError"===error.name?console.log(`Fetching ${audioName} file aborted`):(console.error(error),alert("Error"))}},playBtn.addEventListener("click",()=>{replayBtn.classList.remove("invisible")}),replayBtn.onclick=()=>{audioEl1.load(),audioEl1.play(),replayBtn.children[0].animate([{transform:"rotate(-360deg)"}],{duration:300,iterations:1})},prevBtn.onclick=()=>{var temp=prevAud;setPrevAud(),playRandomAudio(temp),setNextAud(temp.next)},nextBtn.onclick=async()=>{if(!isWaitingAudio){let objectUrl=await Promise.race([nextAud.objectUrl,"pending"]);"pending"===objectUrl&&(audioTitleEl.innerText="Loading...",audioTitleEl.classList.add("cursor-wait"),isWaitingAudio=!0,objectUrl=await nextAud),""===objectUrl?alert("error"):(nextAud.objectUrl=objectUrl,clearAudioData(prevAud),setPrevAud(),playRandomAudio(nextAud),setNextAud(nextAud.next))}},document.onclick=e=>{var isInfoExpanded="true"===infoBtn.ariaExpanded,isLangListExpanded="true"===langBtn.ariaExpanded,isMenuExpanded="true"===menuBtn.ariaExpanded;!isInfoExpanded||infoEl.contains(e.target)||infoBtn.contains(e.target)||(infoEl.classList.add("hidden"),infoBtn.setAttribute("aria-expanded",!1)),!isLangListExpanded||langListEl.contains(e.target)||langBtn.contains(e.target)||(langListEl.classList.add("hidden"),langBtn.setAttribute("aria-expanded",!1)),!isMenuExpanded||menuEl.contains(e.target)||menuBtn.contains(e.target)||playlistEl.contains(e.target)||toggleMenuWindow()},document.onkeydown=e=>{var isLangListExpanded,isPlaylistExpanded,isMenuExpanded;"Escape"===e.key&&(e="true"===infoBtn.ariaExpanded,isLangListExpanded="true"===langBtn.ariaExpanded,isPlaylistExpanded="true"===playlistBtn.ariaExpanded,isMenuExpanded="true"===menuBtn.ariaExpanded,e&&(infoEl.classList.add("hidden"),infoBtn.setAttribute("aria-expanded",!1)),isLangListExpanded&&(langListEl.classList.add("hidden"),langBtn.setAttribute("aria-expanded",!1)),isPlaylistExpanded&&togglePlaylistWindow(),isMenuExpanded)&&toggleMenuWindow()},window.onblur=()=>{audioEl1.pause(),audioEl2.pause()};